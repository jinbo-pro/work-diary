# 强缓存和协商缓存

参考链接

- 【[彻底弄懂强缓存与协商缓存](https://www.jianshu.com/p/9c95db596df5)】
- 【[浏览器请求缓存流程图](https://www.processon.com/view/link/61e280a1e0b34d1be7f82bc3)】

## 缓存的优点

- 减少不必要的数据传输，节省带宽
- 减少服务器负担，提升网站性能
- 加快客服端加载速度
- 更好的用户体验

## 缓存的缺点

- 资源更新不及时导致信息滞后，若以前的版本有 bug 则影响更大

# 强缓存

当浏览器去请求某个文件的时候，服务端就在`respone header`里面对该文件做了缓存配置

强制缓存一般`respone header`设置为

```js
cache-control:max-age=31536000,public,immutable
```

他的意思是

> max-age 表示缓存的时间是 31536000 秒（1 年），
>
> public 表示可以被浏览器和代理服务器缓存，代理服务器一般可用 nginx 来做。
>
> immutable 表示该资源永远不变，但是实际上该资源并不是永远不变，这么设置的意思是为了让用户在刷新页面的时候不要去请求服务器！

**注意：在缓存有效期间内浏览器不会发送请求只会读取内存或磁盘中的数据**

# 协商缓存

上面说到的强缓存就是给资源设置个过期时间，客户端每次请求资源时都会看是否过期；只有在过期才会去询问服务器。那么过期后询问服务器的时候就可以设置协商缓存了

协商则需要客户端和服务器进行交互，如果资源更新了就返回新的资源，

如果没有更新就会返回 304 的状态码，告诉客户端服务端资源没有更新你继续用之前的缓存吧

如果有跟新就会返回 200 的转态码和最新的资源文件

协商缓存一般``response header`里面的设置为

```js
etag: '5c20abbd-e2e8'
last-modified: Mon, 24 Dec 2018 09:49:49 GMT
```

etag：每个文件有一个，改动文件了就变了，就是个文件 hash，每个文件唯一

ast-modified：文件的修改时间，精确到秒
