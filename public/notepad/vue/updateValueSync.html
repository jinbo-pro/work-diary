<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://lib.baomitu.com/vue/2.6.10/vue.min.js"></script>
    <title>vue-hello</title>
  </head>

  <body>
    <div id="app">
      <hello :msg.sync="msg"></hello>
    </div>
    <script>
      const list = [...'123456']
      const hello = {
        template: `
        <div>
          <button @click="handel">点击1</button>
          <p><br /></p>
          <button @click="handel2">点击2</button>
          <h1>{{ msg }}</h1>
        </div>
        `,
        props: {
          msg: String
        },
        watch: {
          msg(v) {
            console.log(v, '-->>> HelloWorld watch')
          }
        },
        methods: {
          // 使用 $nextTick 等 update:msg 更新完成
          async handel() {
            for (let i of list) {
              console.log([i, this.msg], 'i, msg')
              if (!this.msg) {
                this.$emit('update:msg', i)
                // await this.$nextTick()
              }
            }
          },
          // 使用临时变量
          async handel2() {
            let msg = ''
            for (let i of list) {
              console.log([i, msg], 'i, msg')
              if (!msg) {
                msg = i
              }
            }
            if (!this.msg) {
              this.$emit('update:msg', msg)
            }
          }
        }
      }

      new Vue({
        el: '#app',
        components: {
          hello
        },
        data() {
          return {
            msg: ''
          }
        },
        beforeUpdate() {
          console.log(this.msg, '-->>> msg page beforeUpdate')
        },
        updated() {
          console.log(this.msg, '-->>> msg page updated')
        }
      })
    </script>
  </body>
</html>
