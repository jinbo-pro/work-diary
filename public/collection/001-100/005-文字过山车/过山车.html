<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="lijinbo" />
    <title>过山车</title>
    <style>
      .box {
        padding: 20px;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <div id="ulBox"></div>
    </div>
    <script type="text/javascript">
      const count = 80
      const W = document.documentElement.clientWidth
      const H = document.documentElement.clientHeight
      let scrollTop = 0
      // 延迟函数
      function sleep(t) {
        return new Promise((a) => setTimeout(a, t))
      }
      let rangeMax = Math.floor((W - 100) / 16)
      const docList = '😀,😁,😂,🤣,😃,😄,😅,😆,😉,😊,😋,😎,😍,😘,🥰,😗,👩,👨,🧑,👱,😖'.split(',')
      const range = { min: 1, max: rangeMax } // 文案区域(波峰，波谷)
      const randomToggleNum = 0.3 // 随机反转几率
      let docCount = 1 // 文案叠加初始量
      let toggle = true // 反转值 true 增加 false
      // 输出文案
      function resultDoc() {
        let result = '',
          len = docList.length
        for (let i = 0; i < docCount; i++) {
          let item = '//'
          if (i == docCount - 1) {
            item = docList[~~(Math.random() * len)]
          }
          result += item
        }
        scrollTop += 21
        document.documentElement.scrollTop = scrollTop
        renderDoc(result)
      }

      // 文字叠加的范围
      function getRange() {
        // 随机反转
        if (Math.random() < randomToggleNum) {
          toggle = Math.random() < 0.5
        }
        // 文案区域判断
        if (docCount >= range.max) {
          toggle = false
        } else if (docCount <= range.min) {
          toggle = true
        }
      }
      // 渲染到页面
      function renderDoc(doc) {
        var ulBox = document.getElementById('ulBox')
        var div = document.createElement('div')
        div.innerText = doc
        ulBox.appendChild(div)
      }

      async function run() {
        for (let i = 1; i < count; i++) {
          getRange()
          toggle ? docCount++ : docCount--
          resultDoc()
          await sleep(30)
        }
      }
      run()
    </script>
  </body>
</html>
